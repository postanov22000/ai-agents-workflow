<div class="main-content">
  <h1>Welcome back, <span>{{ name }}</span> ðŸ‘‹</h1>


  <!-- Add this with the other metric cards -->
<div class="metric-card">
    <i class="fas fa-envelope metric-icon"></i>
    <h3>Email Connection</h3>
    <div class="metric-value" id="email-status">
        <span id="status-text">Checking...</span>
        <div id="status-icon"></div>
    </div>
    <div class="progress-container">
        <div id="reverify-btn" style="display: none; margin-top: 10px;">
            <button class="btn btn-warning" onclick="verifyEmailConnection()">
                <i class="fas fa-sync-alt"></i> Re-verify
            </button>
        </div>
    </div>
</div>
  <!-- Metrics Grid -->
  <div class="metrics-grid">
    <div class="metric-card">
      <i class="fas fa-paper-plane metric-icon"></i>
      <h3>Emails Sent</h3>
      <div class="metric-value" id="emails-sent">{{ emails_sent }}</div>
      <div class="progress-container">
        <div class="progress-bar"><div class="progress-fill" id="email-progress"></div></div>
        <div class="trend up"><i class="fas fa-arrow-up"></i>
          <span>{{ 20 - emails_sent }} remaining</span>
        </div>
      </div>
    </div>

    <div class="metric-card">
      <i class="fas fa-clock metric-icon"></i>
      <h3>Time Saved</h3>
      <div class="metric-value" id="time-saved">{{ time_saved }} min</div>
      <div class="trend up"><i class="fas fa-arrow-up"></i>
        <span>{{ (time_saved//60)|default(0) }} hours saved</span>
      </div>
    </div>

    <div class="metric-card">
      <i class="fas fa-brain metric-icon"></i>
      <h3>AI Responder</h3>
      <div class="metric-value">
        {% if ai_enabled %}
          <span class="status active"><i class="fas fa-check-circle"></i> Active</span>
        {% else %}
          <span class="status inactive"><i class="fas fa-exclamation-circle"></i> Inactive</span>
        {% endif %}
      </div>
      <div class="trend {% if ai_enabled %}up{% else %}down{% endif %}">
        {% if ai_enabled %}
          <i class="fas fa-check-circle"></i> All systems operational
        {% else %}
          <i class="fas fa-exclamation-circle"></i> Service paused
        {% endif %}
      </div>
    </div>

    <!-- Kits Generated (replaces Monthly Revenue) -->
    <div class="metric-card">
      <i class="fas fa-box metric-icon"></i>
      <h3>Kits Generated</h3>
      <div class="metric-value" id="kits-generated">
        {{ kits_generated }}
      </div>
      <div class="trend up">
        <i class="fas fa-check-circle"></i>
        <span>{{ kits_generated }} this session</span>
      </div>
    </div>
  </div>


  
  <!-- Action Section -->
  <div class="action-grid">
    <div class="action-card">
      <h3>Account Actions</h3>
      <div class="action-buttons">
        <form method="POST" action="/disconnect_gmail">
          <input type="hidden" name="user_id" value="{{ user_id }}" />
         <!-- <button type="submit" class="btn btn-danger">
            <i class="fas fa-unlink"></i> Disconnect Gmail
          </button>      -->
        </form>

        {% if show_reconnect %}
        <form action="/connect_gmail" method="GET">
        <!--  <button class="btn btn-primary">
            <i class="fas fa-link"></i> Reconnect Gmail
          </button>   -->
        </form>
        {% endif %}

        <a href="upgrade.html" class="btn btn-warning">
          <i class="fas fa-rocket"></i> Upgrade Plan
        </a>
      </div>
    </div>
<!-------->
<!-- Add this where you want the link -->
<!--<a href="/import_leads?user_id={{ user_id }}" class="btn">Import Leads</a>  -->
    <div class="action-card">
<!-------->
    <div class="action-card">
      <h3>Outreach engine</h3>
      <a href="/import_leads?user_id={{ user_id }}" class="btn btn-primary">
        <i class="fas fa-file-contract"></i> Import leads
      </a>
      <small style="color:#ccc; display:block; margin-top:8px;">
        Click to import your leads for outreach.
      </small>
    </div>
  </div>

  <script>
    
    function safeAnimate(id, end, duration) {
    const el = document.getElementById(id);
    if (!el) return;
    animateValue(id, 0, end, duration);
  }

  const emails = {{ emails_sent }};
  const estimated = {{ estimated_saved }};
  const kits    = {{ kits_generated }};
  document.getElementById('email-progress').style.width = `${(emails/20)*100}%`;
  safeAnimate('emails-sent', emails,  800);
  safeAnimate('time-saved',  emails*5.5 + estimated, 800);
  safeAnimate('kits-generated', kits, 800);


    // ----------------------------------------
    // Function to check email connection status
function checkEmailStatus() {
    const userId = "{{ user_id }}";
    if (!userId) return;
    
    fetch(`/check_smtp_status?user_id=${userId}`)
        .then(response => response.json())
        .then(data => {
            const statusText = document.getElementById('status-text');
            const statusIcon = document.getElementById('status-icon');
            const reverifyBtn = document.getElementById('reverify-btn');
            
            statusIcon.innerHTML = '';
            reverifyBtn.style.display = 'none';
            
            if (data.status === 'valid') {
                statusText.innerHTML = 'Connected';
                statusIcon.innerHTML = '<i class="fas fa-check-circle" style="color: #64ffda; margin-left: 5px;"></i>';
            } else if (data.status === 'partial') {
                statusText.innerHTML = 'Partial';
                statusIcon.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #f8961e; margin-left: 5px;"></i>';
                reverifyBtn.style.display = 'block';
            } else {
                statusText.innerHTML = 'Not Connected';
                statusIcon.innerHTML = '<i class="fas fa-times-circle" style="color: #f72585; margin-left: 5px;"></i>';
                reverifyBtn.style.display = 'block';
            }
        })
        .catch(error => {
            console.error('Error checking email status:', error);
            document.getElementById('status-text').innerHTML = 'Error checking';
            document.getElementById('status-icon').innerHTML = '<i class="fas fa-times-circle" style="color: #f72585; margin-left: 5px;"></i>';
            document.getElementById('reverify-btn').style.display = 'block';
        });
}

// Function to reverify connection
function verifyEmailConnection() {
    const statusText = document.getElementById('status-text');
    const statusIcon = document.getElementById('status-icon');
    const reverifyBtn = document.getElementById('reverify-btn');
    
    statusText.innerHTML = 'Testing...';
    statusIcon.innerHTML = '<i class="fas fa-spinner fa-spin" style="margin-left: 5px;"></i>';
    reverifyBtn.style.display = 'none';
    
    // Call the check again
    checkEmailStatus();
}

// Check email status on page load
document.addEventListener('DOMContentLoaded', function() {
    // Wait a moment for the page to load fully
    setTimeout(checkEmailStatus, 1000);
});
  </script>
</div>
